<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>Canvasting</title>
   <link href="css/base.css" rel="stylesheet">
   <script type="importMap">
      {
         "imports": {
            "main": "./scripts/main.js",
            "cssConfig": "./scripts/cssConfig.js",
            "rain": "./scripts/rain.js",
            "eventManager": "./scripts/eventManager.js"
         }
      } 
   </script>
</head>

<body>
   <canvas id="canvas"></canvas>
</body>

<!-- <script type="module"> -->
<!--    import {Main} from "main"; -->
<!---->
<!--    const test = new Main(); -->
<!--    console.log(test.render()); -->
<!-- </script> -->
<script type="module">
   import {RainScene} from "rain";
   import {CssConfig} from "cssConfig";
   import eventManager from "eventManager";

   const canvas = document.getElementById("canvas");
   const test = new RainScene(canvas);
   test.resizeCanvas();
   test.initScene();
   test.drawScene();

   const body = document.body;
   const toAppendTo = {selector: ".cssConfig", position: {value: "absolute"}, top: {value: 10, unit: "px"}, right: {value: 10, unit: "px"}};
   const optionsToCreate = [
      {
         tagName: "input",
         name: "alter-density",
         attributes: {
            title: "alter-density",
            class: "range inputable",
            type: "range",
            min: 0,
            max: 100,
            value: test.density,
         },
         properties: [{
            selector: ".range",
            height: {
               value: 50,
               unit: "px",
            },
            width: {
               value: 100,
               unit: "px",
            },
         }],
      },
      {
         tagName: "input",
         name: "alter-speed",
         attributes: {
            title: "alter-speed",
            class: "range inputable",
            type: "range",
            min: 0,
            max: 100,
         },
         properties: [{
            selector: ".range",
            height: {
               value: 50,
               unit: "px",
            },
            width: {
               value: 100,
               unit: "px",
            },
         }],
      },
   ];

   optionsToCreate[0].events = [{
      eventName: optionsToCreate[0].name.split("-").map((string, index) => index == 1 ? string.substring(0, 1).toUpperCase() + string.substring(1) : string).join(""),
      eventListener: "input",
      eventDelegates: RainScene,
      callback: function (elem) {
         elem.addEventListener("input", function (e) {
            // console.log(e.target.value);
            e.target.setAttribute("value", e.target.value);
            let data = {
               await: false,
               awaitDetail: () => { },
               details: {
                  target: e.target,
               },
               eventName: "alterDensity",
            }
            eventManager.publishCustomEvent(data);
         });
      },
   },
   ];


   const cssConfig = new CssConfig();
   cssConfig.createOptions(optionsToCreate);
   cssConfig.init(body, toAppendTo);

   window.addEventListener("resize", test.resizeCanvas.bind(test));
</script>

</html>
